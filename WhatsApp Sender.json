{"data":{"edges":[],"nodes":[{"data":{"node":{"template":{"_type":"Component","access_token":{"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"access_token","value":"EAAO30InbfOwBPE8dwtcZAlfwMg2w4cjRHJgjOoQYXeY6aYrvk94nxvZCqYJHZBYo0ZAyHJAZCVt7yDrWBMKMKem6oAjDDguBlJtgxWBEv25Qa8FqxTHqYHfUVhZC407bEmfxYsTXGPB7ZCS790Cn2JMgoDiEfZCcTgnZCfXSlW2GC9sfawynhW1dZCtyyOHxZBozj4k","display_name":"Access Token","advanced":false,"input_types":["Message"],"dynamic":false,"info":"The authorization token for the Facebook Graph API.","title_case":false,"type":"str","_input_type":"MessageTextInput"},"body":{"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"body","value":"hye","display_name":"Body","advanced":false,"input_types":["Message"],"dynamic":false,"info":"The text of the message.","title_case":false,"type":"str","_input_type":"MessageTextInput"},"code":{"type":"code","required":true,"placeholder":"","list":false,"show":true,"multiline":true,"value":"import requests\r\nimport json\r\n\r\nfrom langflow.custom.custom_component.component import Component\r\nfrom langflow.io import MessageTextInput, Output, DropdownInput, BoolInput\r\nfrom langflow.schema.data import Data\r\n\r\n\r\nclass WhatsAppSenderComponent(Component):\r\n    display_name = \"WhatsApp Sender\"\r\n    description = \"Sends messages via WhatsApp using the Facebook Graph API.\"\r\n    documentation = \"https://developers.facebook.com/docs/whatsapp/cloud-api\"\r\n    icon = \"whatsapp\"\r\n    name = \"WhatsAppSender\"\r\n\r\n    inputs = [\r\n        MessageTextInput(\r\n            name=\"access_token\",\r\n            display_name=\"Access Token\",\r\n            info=\"The authorization token for the Facebook Graph API.\",\r\n            required=True,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"phone_number\",\r\n            display_name=\"Phone Number\",\r\n            info=\"The recipient's phone number (including country code).\",\r\n            required=True,\r\n        ),\r\n        DropdownInput(\r\n            name=\"recipient_type\",\r\n            display_name=\"Recipient Type\",\r\n            options=[\"individual\"],\r\n            value=\"individual\",\r\n            info=\"The recipient type.\",\r\n            required=True,\r\n        ),\r\n        DropdownInput(\r\n            name=\"message_type\",\r\n            display_name=\"Message Type\",\r\n            options=[\"text\"],\r\n            value=\"text\",\r\n            info=\"The type of message to send.\",\r\n            required=True,\r\n            real_time_refresh=True,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"body\",\r\n            display_name=\"Body\",\r\n            info=\"The text of the message.\",\r\n            required=True,\r\n        ),\r\n        BoolInput(\r\n            name=\"preview_url\",\r\n            display_name=\"Enable Link Preview\",\r\n            value=False,\r\n            info=\"Enable or disable link previews in the message.\",\r\n            required=True,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"whatsapp_business_phone_number_id\",\r\n            display_name=\"WhatsApp Business Phone Number ID\",\r\n            info=\"The WhatsApp Business Phone Number ID.\",\r\n            required=True,\r\n        ),\r\n       \r\n    ]\r\n\r\n    outputs = [\r\n        Output(display_name=\"Response\", name=\"response\", method=\"send_message\"),\r\n    ]\r\n\r\n    def send_message(self) -> Data:\r\n        \"\"\"Sends a WhatsApp message using the Facebook Graph API.\"\"\"\r\n        try:\r\n            url = f\"https://graph.facebook.com/v22.0/{self.whatsapp_business_phone_number_id}/messages\"\r\n            headers = {\r\n                \"Authorization\": f\"Bearer {self.access_token}\",\r\n                \"Content-Type\": \"application/json\",\r\n            }\r\n            data = {\r\n                \"messaging_product\": \"whatsapp\",\r\n                \"recipient_type\": self.recipient_type,\r\n                \"to\": self.phone_number,\r\n                \"type\": self.message_type,\r\n                \"text\": {\r\n                    \"preview_url\": self.preview_url,\r\n                    \"body\": self.body,\r\n                },\r\n            }\r\n            response = requests.post(url, headers=headers, data=json.dumps(data))\r\n            response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)\r\n            result = response.json()\r\n            self.status = str(result)\r\n            return Data(value=result)\r\n        except requests.exceptions.RequestException as e:\r\n            error_message = f\"Error sending message: {e}\"\r\n            self.status = error_message\r\n            return Data(value={\"error\": error_message})\r\n        except Exception as e:  # noqa: BLE001\r\n            error_message = f\"An unexpected error occurred: {e}\"\r\n            self.status = error_message\r\n            return Data(value={\"error\": error_message})\r\n\r\n    def update_build_config(self, build_config: dict, field_name: str, field_value: any) -> dict:\r\n        \"\"\"Updates the build config based on the selected message type.\"\"\"\r\n        if field_name == \"message_type\":\r\n            if field_value == \"text\":\r\n                build_config[\"body\"] = {\r\n                    \"display_name\": \"Body\",\r\n                    \"info\": \"The text of the message.\",\r\n                    \"name\": \"body\",\r\n                    \"required\": True,\r\n                    \"placeholder\": \"\",\r\n                    \"field_type\": \"MessageTextInput\",\r\n                }\r\n                build_config[\"preview_url\"] = {\r\n                    \"display_name\": \"Enable Link Preview\",\r\n                    \"info\": \"Enable or disable link previews in the message.\",\r\n                    \"name\": \"preview_url\",\r\n                    \"value\": False,\r\n                    \"required\": True,\r\n                    \"field_type\": \"BoolInput\",\r\n                }\r\n            else:\r\n                build_config.pop(\"body\", None)\r\n                build_config.pop(\"preview_url\", None)\r\n        return build_config","fileTypes":[],"file_path":"","password":false,"name":"code","advanced":true,"dynamic":true,"info":"","load_from_db":false,"title_case":false},"message_type":{"tool_mode":false,"trace_as_metadata":true,"options":["text"],"options_metadata":[],"combobox":false,"dialog_inputs":{},"toggle":false,"required":true,"placeholder":"","show":true,"name":"message_type","value":"text","display_name":"Message Type","advanced":false,"dynamic":false,"info":"The type of message to send.","real_time_refresh":true,"title_case":false,"type":"str","_input_type":"DropdownInput"},"phone_number":{"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"phone_number","value":"+601158829483","display_name":"Phone Number","advanced":false,"input_types":["Message"],"dynamic":false,"info":"The recipient's phone number (including country code).","title_case":false,"type":"str","_input_type":"MessageTextInput"},"preview_url":{"tool_mode":false,"trace_as_metadata":true,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"preview_url","value":true,"display_name":"Enable Link Preview","advanced":false,"dynamic":false,"info":"Enable or disable link previews in the message.","title_case":false,"type":"bool","_input_type":"BoolInput","load_from_db":false},"recipient_type":{"tool_mode":false,"trace_as_metadata":true,"options":["individual"],"options_metadata":[],"combobox":false,"dialog_inputs":{},"toggle":false,"required":true,"placeholder":"","show":true,"name":"recipient_type","value":"individual","display_name":"Recipient Type","advanced":false,"dynamic":false,"info":"The recipient type.","title_case":false,"type":"str","_input_type":"DropdownInput"},"whatsapp_business_phone_number_id":{"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"load_from_db":false,"list":false,"list_add_label":"Add More","required":true,"placeholder":"","show":true,"name":"whatsapp_business_phone_number_id","value":"678162045376023","display_name":"WhatsApp Business Phone Number ID","advanced":false,"input_types":["Message"],"dynamic":false,"info":"The WhatsApp Business Phone Number ID.","title_case":false,"type":"str","_input_type":"MessageTextInput"}},"description":"Sends messages via WhatsApp using the Facebook Graph API.","icon":"whatsapp","base_classes":["Data"],"display_name":"WhatsApp Sender","documentation":"https://developers.facebook.com/docs/whatsapp/cloud-api","minimized":false,"custom_fields":{},"output_types":[],"pinned":false,"conditional_paths":[],"frozen":false,"outputs":[{"types":["Data"],"selected":"Data","name":"response","hidden":null,"display_name":"Response","method":"send_message","value":"__UNDEFINED__","cache":true,"required_inputs":null,"allows_loop":false,"group_outputs":false,"options":null,"tool_mode":true}],"field_order":["access_token","phone_number","recipient_type","message_type","body","preview_url","whatsapp_business_phone_number_id"],"beta":false,"legacy":false,"edited":true,"metadata":{},"tool_mode":false,"lf_version":"1.5.0.post1","official":false},"showNode":true,"type":"WhatsAppSender","id":"CustomComponent-5P5nq"},"id":"CustomComponent-5P5nq","position":{"x":0,"y":0},"type":"genericNode"}],"viewport":{"x":1,"y":1,"zoom":1}},"description":"Sends messages via WhatsApp using the Facebook Graph API.","name":"WhatsApp Sender","id":"CustomComponent-5P5nq","is_component":true,"last_tested_version":"1.5.0.post1"}